<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ì‘ë¬¼ ìƒìœ¡ ì§„ë‹¨</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #008000;
            border-bottom: 2px solid #b4cd13;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        select, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .submit-btn {
            background-color: #008000;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #b4cd13;
        }
        .result-box {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            /* ğŸš¨ result_color ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°ê²½ìƒ‰ ë° ê²½ê³„ì„  ìƒ‰ìƒ ì„¤ì • */
            background-color: {% if result_color == 'green' %}#e6ffe6{% elif result_color == 'red' %}#ffe6e6{% else %}#f0f0f0{% endif %};
            border-left: 5px solid {% if result_color == 'green' %}#008000{% elif result_color == 'red' %}#ff0000{% else %}#ccc{% endif %};
        }
        .result-box strong {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .temp-type-group {
            margin-top: 10px;
            display: flex;
            gap: 15px;
        }
        .temp-type-group label {
            font-weight: normal;
        }

    </style>
    <!-- ìƒë‹¨ë°” ë””ìì¸ì„ ìœ„í•œ style.css ë¡œë“œ -->
    <link rel="stylesheet" href="/static/style.css">
    <script>
        function toggleTempType() {
            const crop = document.getElementById('crop').value;
            const item = document.getElementById('item').value;
            const tempDiv = document.getElementById('temp-type-selection');

            // í† ë§ˆí† ë‚˜ ë”¸ê¸° ì„ íƒ & í•­ëª©ì´ 'ì˜¨ë„'ì¼ ë•Œë§Œ ì£¼ê°„/ì•¼ê°„ ì„ íƒì°½ í‘œì‹œ
            if ((crop === 'í† ë§ˆí† ' || crop === 'ë”¸ê¸°') && item === 'ì˜¨ë„') {
                tempDiv.style.display = 'block';
            } else {
                tempDiv.style.display = 'none';
                // ë‹¤ë¥¸ í•­ëª©ì„ ì„ íƒí•˜ë©´ ë¼ë””ì˜¤ ë²„íŠ¼ ì²´í¬ í•´ì œ
                document.querySelectorAll('input[name="temp_type"]').forEach(radio => radio.checked = false);
            }
        }

        // ì´ˆê¸° ë¡œë”© ì‹œ ë° ì‘ë¬¼/í•­ëª© ë³€ê²½ ì‹œ í•¨ìˆ˜ í˜¸ì¶œ
        document.addEventListener('DOMContentLoaded', () => {
            toggleTempType();
            document.getElementById('crop').addEventListener('change', toggleTempType);
            document.getElementById('item').addEventListener('change', toggleTempType);
        });
    </script>
</head>
<body>
    <nav class="top-bar">
        <div class="navbar_name">
            <a href="/">S.J.D.J</a>
        </div>
        <!-- ... (ë„¤ë¹„ê²Œì´ì…˜ ëª©ë¡ ìœ ì§€) ... -->
        <ul class="navbar_list">
            <li><a href="/about">ì‹¤ì¦ë‹¨ì§€ ì†Œê°œ</a></li>
            <li><a href="/datas">ì˜¨ì‹¤ 3D ëª¨ë¸ë§</a></li>
            <li><a href="/participate">ì‹¤ì‹œê°„ ë°ì´í„°</a></li>
            <li><a href="/sns">ì˜ê²¬ ê²Œì‹œíŒ</a></li>
            <li><a href="/aichat">AI ì±—ë´‡</a></li>
        </ul>

        <ul class="user-info">
            {% if user %}
                {{ user.username }} ({{ user.role }}) ë‹˜ ë¡œê·¸ì¸ë¨ |
                <a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
            {% else %}
                <a href="/login">ë¡œê·¸ì¸</a> /
                <a href="/register">íšŒì›ê°€ì…</a>
            {% endif %}
        </ul>
    </nav>

    <div class="container">
        <h1>ğŸŒ± ì‘ë¬¼ í™˜ê²½ ìµœì í™” ì§„ë‹¨ ì‹œìŠ¤í…œ</h1>

        <!-- ğŸš¨ ìˆ˜ì • 1: form actionì„ ì˜¬ë°”ë¥¸ POST ë¼ìš°í„° ê²½ë¡œë¡œ ë³€ê²½ -->
        <form method="POST" action="/participate">

            <label for="crop">1. ì‘ë¬¼ ì„ íƒ</label>
            <select id="crop" name="crop" onchange="toggleTempType()" required>
                {% for c in crops %}
                    <!-- ğŸš¨ ìˆ˜ì • 2: Jinja2 ë³€ìˆ˜ëª…ì„ selected_cropìœ¼ë¡œ í†µì¼ -->
                    <option value="{{ c }}" {% if c == selected_crop %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>

            <label for="item">2. ì§„ë‹¨ í•­ëª©</label>
            <select id="item" name="item" onchange="toggleTempType()" required>
                {% for i in items %}
                    <!-- ğŸš¨ ìˆ˜ì • 2: Jinja2 ë³€ìˆ˜ëª…ì„ selected_itemìœ¼ë¡œ í†µì¼ -->
                    <option value="{{ i }}" {% if i == selected_item %}selected{% endif %}>{{ i }}</option>
                {% endfor %}
            </select>

            <!-- ì£¼ê°„/ì•¼ê°„ ì˜¨ë„ ì„ íƒ í•„ë“œ (ì¡°ê±´ë¶€ í‘œì‹œ) -->
            <div class="form-group" id="temp-type-selection" style="display: none;">
                <label>3. ì‹œê°„ëŒ€ ì„ íƒ:</label>
                <div class="temp-type-group">
                    <!-- ğŸš¨ ìˆ˜ì • 2: Jinja2 ë³€ìˆ˜ëª…ì„ selected_temp_typeìœ¼ë¡œ í†µì¼ -->
                    <input type="radio" id="day" name="temp_type" value="day" {% if selected_temp_type == 'day' %}checked{% endif %}>
                    <label for="day">ì£¼ê°„ ì˜¨ë„</label>
                    <input type="radio" id="night" name="temp_type" value="night" {% if selected_temp_type == 'night' %}checked{% endif %}>
                    <label for="night">ì•¼ê°„ ì˜¨ë„</label>
                </div>
            </div>

            <!-- ğŸš¨ ìˆ˜ì • 3: name ì†ì„±ì„ user_valueë¡œ ë³€ê²½ -->
            <label for="user_value">4. í˜„ì¬ ê°’ ì…ë ¥</label>
            <input type="text" id="user_value" name="user_value" placeholder="ì¸¡ì •ëœ ê°’ì„ ì…ë ¥í•˜ì„¸ìš” (ìˆ«ìë§Œ)" value="{{ selected_value or '' }}" required>

            <button type="submit">ğŸ” ìƒíƒœ ì ê²€ ë° í”¼ë“œë°± ë°›ê¸°</button>
        </form>

        <!-- ğŸš¨ ìˆ˜ì • 4: ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
        {% if result %}
        <div class="result-box">
            <h3>ì§„ë‹¨ ê²°ê³¼:</h3>
            {{ result | safe }}
        </div>
        {% endif %}
    </div>
</body>
</html>